<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Econom√≠a Familiar - Juntos</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí∞</text></svg>">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-brand">
            <span class="navbar-icon">üí∞</span>
            <span class="navbar-title">Econom√≠a Familiar</span>
        </div>
        <div class="navbar-user">
            <span id="userEmail"></span>
            <button class="btn-logout" onclick="logout()">Salir</button>
        </div>
    </nav>
    
    <!-- Emotional Component -->
    <div class="emotional-banner" id="emotionalBanner">
        <p>"Esto lo estamos ordenando juntos"</p>
    </div>
    
    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <ul class="nav-menu">
                <li class="nav-item active" data-screen="resumen">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Resumen Mensual</span>
                </li>
                <li class="nav-item" data-screen="saldo">
                    <span class="nav-icon">üí≥</span>
                    <span class="nav-text">Saldo por Medio</span>
                </li>
                <li class="nav-item" data-screen="gastos">
                    <span class="nav-icon">üìà</span>
                    <span class="nav-text">Gastos por Categor√≠a</span>
                </li>
                <li class="nav-item" data-screen="postres">
                    <span class="nav-icon">üç∞</span>
                    <span class="nav-text">Postres</span>
                </li>
                <li class="nav-item" data-screen="fondos">
                    <span class="nav-icon">üè¶</span>
                    <span class="nav-text">Fondos / Ahorros</span>
                </li>
                <li class="nav-item" data-screen="historial">
                    <span class="nav-icon">üìã</span>
                    <span class="nav-text">Historial</span>
                </li>
                <li class="nav-item" data-screen="nuevo">
                    <span class="nav-icon">‚ûï</span>
                    <span class="nav-text">Nuevo Movimiento</span>
                </li>
            </ul>
            
            <div class="sidebar-footer">
                <div class="balance-summary">
                    <p class="balance-label">Balance del mes</p>
                    <p class="balance-amount" id="balanceAmount">$0</p>
                </div>
                <p class="emotional-quote">"Construyendo tranquilidad juntos"</p>
            </div>
        </nav>
        
        <!-- Content Area -->
        <main class="content">
            <!-- Resumen Mensual Screen -->
            <div class="screen active" id="resumen">
                <div class="screen-header">
                    <h1>üìä Resumen Mensual</h1>
                    <div class="month-selector">
                        <button class="btn-icon" onclick="changeMonth(-1)">‚Üê</button>
                        <span id="currentMonth">Mayo 2024</span>
                        <button class="btn-icon" onclick="changeMonth(1)">‚Üí</button>
                    </div>
                </div>
                
                <div class="summary-cards">
                    <div class="summary-card income">
                        <h3>Ingresos Totales</h3>
                        <p class="amount" id="totalIncome">$0</p>
                        <div class="person-breakdown">
                            <span>Sebasti√°n: <span id="incomeSebastian">$0</span></span>
                            <span>Ludmila: <span id="incomeLudmila">$0</span></span>
                        </div>
                    </div>
                    
                    <div class="summary-card expense">
                        <h3>Gastos Totales</h3>
                        <p class="amount" id="totalExpense">$0</p>
                        <div class="category-preview" id="topCategories"></div>
                    </div>
                    
                    <div class="summary-card balance">
                        <h3>Balance del Mes</h3>
                        <p class="amount" id="monthBalance">$0</p>
                        <div class="emotional-message" id="balanceMessage">
                            "No es culpa, es equipo"
                        </div>
                    </div>
                </div>
                
                <div class="funds-overview">
                    <h2>üè¶ Estado de Fondos</h2>
                    <div class="funds-container" id="fundsContainer"></div>
                </div>
                
                <div class="postres-summary">
                    <h2>üç∞ Balance Postres</h2>
                    <div class="postres-card">
                        <div class="postres-item">
                            <span>Ventas:</span>
                            <span class="positive" id="postresSales">$0</span>
                        </div>
                        <div class="postres-item">
                            <span>Insumos:</span>
                            <span class="negative" id="postresSupplies">$0</span>
                        </div>
                        <div class="postres-item total">
                            <span>Resultado:</span>
                            <span id="postresResult">$0</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Saldo por Medio Screen -->
            <div class="screen" id="saldo">
                <div class="screen-header">
                    <h1>üí≥ Saldo por Medio</h1>
                </div>
                
                <div class="medium-cards">
                    <div class="medium-card">
                        <h3>üíµ Efectivo</h3>
                        <p class="amount" id="cashBalance">$0</p>
                        <div class="medium-breakdown">
                            <p>Ingresos: <span id="cashIncome">$0</span></p>
                            <p>Gastos: <span id="cashExpense">$0</span></p>
                        </div>
                    </div>
                    
                    <div class="medium-card">
                        <h3>üì± Mercado Pago</h3>
                        <p class="amount" id="mpBalance">$0</p>
                        <div class="medium-breakdown">
                            <p>Ingresos: <span id="mpIncome">$0</span></p>
                            <p>Gastos: <span id="mpExpense">$0</span></p>
                        </div>
                    </div>
                </div>
                
                <div class="transfer-section">
                    <h3>Transferir entre Medios</h3>
                    <div class="transfer-form">
                        <select id="transferFrom">
                            <option value="efectivo">De: Efectivo</option>
                            <option value="mercadopago">De: Mercado Pago</option>
                        </select>
                        <select id="transferTo">
                            <option value="mercadopago">A: Mercado Pago</option>
                            <option value="efectivo">A: Efectivo</option>
                        </select>
                        <input type="number" id="transferAmount" placeholder="Monto">
                        <button class="btn-primary" onclick="makeTransfer()">Transferir</button>
                    </div>
                </div>
            </div>
            
            <!-- Gastos por Categor√≠a Screen -->
            <div class="screen" id="gastos">
                <div class="screen-header">
                    <h1>üìà Gastos por Categor√≠a</h1>
                </div>
                
                <div class="category-chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
                
                <div class="category-list" id="categoryList"></div>
            </div>
            
            <!-- Postres Screen -->
            <div class="screen" id="postres">
                <div class="screen-header">
                    <h1>üç∞ Postres - Resultado Real</h1>
                </div>
                
                <div class="postres-actions">
                    <button class="btn-primary" onclick="showModal('insumo')">
                        ‚ûï Agregar Insumo
                    </button>
                    <button class="btn-success" onclick="showModal('venta')">
                        üí∞ Registrar Venta
                    </button>
                </div>
                
                <div class="postres-stats">
                    <div class="stat-card">
                        <h3>Inversi√≥n Total</h3>
                        <p id="totalInsumos">$0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Ventas Totales</h3>
                        <p id="totalVentas">$0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Ganancia Neta</h3>
                        <p id="gananciaNeta">$0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Margen %</h3>
                        <p id="margen">0%</p>
                    </div>
                </div>
                
                <div class="postres-history">
                    <h3>√öltimos Movimientos</h3>
                    <div class="history-table" id="postresHistory"></div>
                </div>
            </div>
            
            <!-- Fondos / Ahorros Screen -->
            <div class="screen" id="fondos">
                <div class="screen-header">
                    <h1>üè¶ Fondos / Ahorros</h1>
                    <button class="btn-primary" onclick="showModal('fondo')">
                        ‚ûï Movimiento en Fondo
                    </button>
                </div>
                
                <div class="funds-management">
                    <div class="fund-card" id="fundHogar">
                        <div class="fund-header">
                            <h3>Fondo Fijo Hogar</h3>
                            <span class="fund-status ok">OK</span>
                        </div>
                        <div class="fund-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="hogarProgress"></div>
                            </div>
                            <div class="fund-numbers">
                                <span class="current" id="hogarCurrent">$0</span>
                                <span class="target" id="hogarTarget">/$0</span>
                            </div>
                        </div>
                        <div class="fund-actions">
                            <button class="btn-success" onclick="addToFund('hogar')">‚ûï Agregar</button>
                            <button class="btn-warning" onclick="useFromFund('hogar')">‚ûñ Usar</button>
                        </div>
                    </div>
                    
                    <div class="fund-card" id="fundPostres">
                        <div class="fund-header">
                            <h3>Fondo Fijo Postres</h3>
                            <span class="fund-status ok">OK</span>
                        </div>
                        <div class="fund-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="postresFundProgress"></div>
                            </div>
                            <div class="fund-numbers">
                                <span class="current" id="postresFundCurrent">$0</span>
                                <span class="target" id="postresFundTarget">/$0</span>
                            </div>
                        </div>
                        <div class="fund-actions">
                            <button class="btn-success" onclick="addToFund('postres')">‚ûï Agregar</button>
                            <button class="btn-warning" onclick="useFromFund('postres')">‚ûñ Usar</button>
                        </div>
                    </div>
                </div>
                
                <div class="fund-history">
                    <h3>Historial de Movimientos</h3>
                    <div class="history-table" id="fundHistory"></div>
                </div>
            </div>
            
            <!-- Historial Screen -->
            <div class="screen" id="historial">
                <div class="screen-header">
                    <h1>üìã Historial Completo</h1>
                    <div class="filters">
                        <select id="filterType">
                            <option value="">Todos los tipos</option>
                            <option value="income">Ingresos</option>
                            <option value="expense">Gastos</option>
                            <option value="fund_transfer">Fondos</option>
                            <option value="postre">Postres</option>
                        </select>
                        <select id="filterPerson">
                            <option value="">Todas las personas</option>
                            <option value="sebastian">Sebasti√°n</option>
                            <option value="ludmila">Ludmila</option>
                            <option value="joint">Conjunto</option>
                        </select>
                        <input type="date" id="filterDateFrom">
                        <input type="date" id="filterDateTo">
                        <button class="btn-primary" onclick="applyFilters()">Filtrar</button>
                    </div>
                </div>
                
                <div class="history-container">
                    <div class="history-table-container">
                        <table class="history-table-full">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Tipo</th>
                                    <th>Descripci√≥n</th>
                                    <th>Persona</th>
                                    <th>Medio</th>
                                    <th>Monto</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="historyBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Nuevo Movimiento Screen -->
            <div class="screen" id="nuevo">
                <div class="screen-header">
                    <h1>‚ûï Nuevo Movimiento</h1>
                </div>
                
                <div class="movement-type-selector">
                    <button class="movement-type-btn active" data-type="expense">
                        üí∏ Gasto
                    </button>
                    <button class="movement-type-btn" data-type="income">
                        üí∞ Ingreso
                    </button>
                    <button class="movement-type-btn" data-type="fund">
                        üè¶ Fondo
                    </button>
                    <button class="movement-type-btn" data-type="postre">
                        üç∞ Postre
                    </button>
                </div>
                
                <!-- Expense Form -->
                <form id="expenseForm" class="movement-form active">
                    <div class="form-group">
                        <label>Categor√≠a *</label>
                        <select id="expenseCategory" required>
                            <option value="">Seleccionar categor√≠a</option>
                            <option value="alquiler">Alquiler</option>
                            <option value="servicios">Servicios</option>
                            <option value="comida_hogar">Comida hogar</option>
                            <option value="transporte">Transporte</option>
                            <option value="bebe">Beb√©</option>
                            <option value="mascotas">Mascotas</option>
                            <option value="salud">Salud</option>
                            <option value="ropa">Ropa</option>
                            <option value="imprevistos">Imprevistos</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Monto *</label>
                        <input type="number" id="expenseAmount" required min="0" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label>Persona *</label>
                        <select id="expensePerson" required>
                            <option value="sebastian">Sebasti√°n</option>
                            <option value="ludmila">Ludmila</option>
                            <option value="joint">Ambos</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Medio *</label>
                        <select id="expenseMedium" required>
                            <option value="efectivo">Efectivo</option>
                            <option value="mercadopago">Mercado Pago</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Fecha</label>
                        <input type="date" id="expenseDate">
                    </div>
                    
                    <div class="form-group">
                        <label>Nota (opcional)</label>
                        <textarea id="expenseNote" rows="2"></textarea>
                    </div>
                    
                    <button type="button" class="btn-primary" onclick="saveExpense()">
                        Guardar Gasto
                    </button>
                </form>
                
                <!-- Income Form -->
                <form id="incomeForm" class="movement-form">
                    <div class="form-group">
                        <label>Tipo de ingreso *</label>
                        <select id="incomeCategory" required>
                            <option value="">Seleccionar tipo</option>
                            <option value="ingreso_diario_sebastian">Ingreso diario Sebasti√°n</option>
                            <option value="ingreso_diario_ludmila">Ingreso diario Ludmila</option>
                            <option value="otro">Otro ingreso</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Monto *</label>
                        <input type="number" id="incomeAmount" required min="0" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label>Medio *</label>
                        <select id="incomeMedium" required>
                            <option value="efectivo">Efectivo</option>
                            <option value="mercadopago">Mercado Pago</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Fecha</label>
                        <input type="date" id="incomeDate">
                    </div>
                    
                    <div class="form-group">
                        <label>Nota (opcional)</label>
                        <textarea id="incomeNote" rows="2"></textarea>
                    </div>
                    
                    <button type="button" class="btn-primary" onclick="saveIncome()">
                        Guardar Ingreso
                    </button>
                </form>
                
                <!-- Fund Form -->
                <form id="fundForm" class="movement-form">
                    <div class="form-group">
                        <label>Fondo *</label>
                        <select id="fundSelect" required>
                            <option value="">Seleccionar fondo</option>
                            <option value="hogar">Fondo fijo hogar</option>
                            <option value="postres">Fondo fijo postres</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Tipo de operaci√≥n *</label>
                        <select id="fundOperation" required>
                            <option value="ingreso">Agregar dinero (ahorro)</option>
                            <option value="uso">Usar dinero</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Monto *</label>
                        <input type="number" id="fundAmount" required min="0" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label>Persona *</label>
                        <select id="fundPerson" required>
                            <option value="sebastian">Sebasti√°n</option>
                            <option value="ludmila">Ludmila</option>
                            <option value="joint">Ambos</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Medio *</label>
                        <select id="fundMedium" required>
                            <option value="efectivo">Efectivo</option>
                            <option value="mercadopago">Mercado Pago</option>
                        </select>
                    </div>
                    
                    <button type="button" class="btn-primary" onclick="saveFundMovement()">
                        Guardar Movimiento
                    </button>
                </form>
                
                <!-- Postre Form -->
                <form id="postreForm" class="movement-form">
                    <div class="form-group">
                        <label>Tipo de movimiento *</label>
                        <select id="postreType" required>
                            <option value="">Seleccionar tipo</option>
                            <option value="insumo">Compra de insumos</option>
                            <option value="venta">Venta de postres</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Monto *</label>
                        <input type="number" id="postreAmount" required min="0" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label>Medio *</label>
                        <select id="postreMedium" required>
                            <option value="efectivo">Efectivo</option>
                            <option value="mercadopago">Mercado Pago</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Fecha</label>
                        <input type="date" id="postreDate">
                    </div>
                    
                    <div class="form-group">
                        <label>Descripci√≥n (opcional)</label>
                        <textarea id="postreDescription" rows="2"></textarea>
                    </div>
                    
                    <button type="button" class="btn-primary" onclick="savePostreMovement()">
                        Guardar Movimiento
                    </button>
                </form>
            </div>
        </main>
    </div>
    
    <!-- Modals -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle"></h3>
                <button class="btn-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('firebase-messaging-sw.js')
                    .then(registration => {
                        console.log('Service Worker registrado:', registration);
                    })
                    .catch(error => {
                        console.log('Error registrando Service Worker:', error);
                    });
            });
        }
        
        // Sugerencia de instalaci√≥n PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Mostrar sugerencia despu√©s de 30 segundos
            setTimeout(() => {
                if (deferredPrompt && confirm('¬øQuieres instalar la aplicaci√≥n para acceso r√°pido?')) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        deferredPrompt = null;
                    });
                }
            }, 30000);
        });
    </script>
    
    <!-- Firebase and Chart.js -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Main App -->
    <script src="app.js"></script>
</body>
</html>
